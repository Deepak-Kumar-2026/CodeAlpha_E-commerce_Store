<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Mini E-Commerce — Frontend</title>
  <style>
    /* ====== Global Styling ====== */
    :root {
      --accent:#0ea5a4;
      --accent-dark:#047272;
      --muted:#6b7280;
      --bg:#f7fafc;
      --card:#ffffff;
    }
    *{box-sizing:border-box}
    body {
      font-family: Inter,ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,'Helvetica Neue',Arial;
      margin:0;
      background:var(--bg);
      color:#111;
      line-height:1.6;
    }

    /* ====== Navbar ====== */
    header {
      background:#fff;
      padding:16px 24px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      position:sticky;
      top:0;
      z-index:50;
      border-bottom:1px solid #e6eef0;
      box-shadow:0 2px 8px rgba(0,0,0,0.05);
    }
    .brand {
      font-weight:800;
      font-size:22px;
      color:var(--accent-dark);
      letter-spacing:-0.5px;
      cursor:pointer;
    }
    .search {
      flex:1;
      display:flex;
      gap:8px;
      align-items:center;
      max-width:520px;
      margin:0 20px;
    }
    .search input {
      width:100%;
      padding:10px 12px;
      border-radius:10px;
      border:1px solid #d1e7e6;
      transition:all .2s;
    }
    .search input:focus {
      outline:none;
      border-color:var(--accent);
      box-shadow:0 0 0 3px rgba(14,165,164,0.15);
    }
    .filters select {
      padding:9px 10px;
      border-radius:8px;
      border:1px solid #d1e7e6;
      cursor:pointer;
    }
    .icons {
      display:flex;
      gap:12px;
      align-items:center;
    }

    /* Buttons */
    .btn {
      background:var(--accent);
      color:white;
      padding:8px 14px;
      border-radius:10px;
      border:none;
      cursor:pointer;
      font-weight:500;
      transition:all .2s;
    }
    .btn:hover { background:var(--accent-dark); }
    .btn.ghost {
      background:transparent;
      color:var(--accent);
      border:1px solid var(--accent);
    }
    .btn.ghost:hover {
      background:var(--accent);
      color:white;
    }

    main{max-width:1100px; margin:28px auto; padding:0 16px}

    /* hero */
    .hero{display:flex; justify-content:space-between; align-items:center; gap:20px; margin-bottom:20px}
    .hero h1{margin:0; font-size:28px}

    /* grid */
    .grid{display:grid; grid-template-columns: repeat(auto-fill,minmax(220px,1fr)); gap:20px}
    .card{background:var(--card); border-radius:12px; padding:12px; box-shadow:0 6px 18px rgba(2,6,23,0.06); display:flex; flex-direction:column; transition:transform .2s}
    .card:hover{transform:translateY(-4px)}
    .card img{width:100%; height:160px; object-fit:cover; border-radius:8px}
    .meta{display:flex; justify-content:space-between; align-items:center; margin-top:10px}
    .title{font-weight:600}
    .price{font-weight:700; color:var(--accent-dark)}

    /* cart sidebar */
    .cart-btn{position:relative}
    .cart-count{position:absolute; top:-6px; right:-8px; background:#dc2626; color:white; border-radius:8px; padding:2px 6px; font-size:12px}
    .cart-side{position:fixed; right:0; top:0; height:100%; width:360px; transform:translateX(100%); transition:transform .25s ease; background:linear-gradient(180deg,#ffffff,#f8ffff); box-shadow:-12px 0 30px rgba(3,7,18,0.12); padding:20px; z-index:80; overflow-y:auto}
    .cart-side.open{transform:translateX(0)}
    .cart-item{display:flex; gap:10px; margin-bottom:12px; align-items:center}
    .cart-item img{width:60px; height:60px; object-fit:cover; border-radius:8px}

    /* product details */
    .overlay{position:fixed; inset:0; background:rgba(2,6,23,0.45); display:none; align-items:center; justify-content:center; z-index:90}
    .overlay.open{display:flex}
    .modal{background:var(--card); width:min(900px,96%); border-radius:12px; overflow:hidden; display:flex; gap:20px; box-shadow:0 12px 30px rgba(0,0,0,0.2)}
    .modal .left{flex:1}
    .modal img{width:100%; height:420px; object-fit:cover}
    .modal .right{width:380px; padding:18px}

    /* login/register forms */
    .form{background:var(--card); padding:16px; border-radius:8px; box-shadow:0 8px 20px rgba(2,6,23,0.06)}
    input,select{display:block; width:100%; padding:10px 12px; border-radius:8px; border:1px solid #e6eef0; margin-bottom:10px}

    /* ====== Footer ====== */
    footer {
      background:#fff;
      border-top:1px solid #e6eef0;
      padding:40px 16px 20px;
      margin-top:60px;
    }
    .footer-grid {
      max-width:1100px;
      margin:auto;
      display:grid;
      grid-template-columns: repeat(auto-fit,minmax(200px,1fr));
      gap:30px;
    }
    .footer-col h4 {
      font-size:16px;
      font-weight:700;
      margin-bottom:12px;
      color:#111;
    }
    .footer-col ul {list-style:none; padding:0; margin:0}
    .footer-col ul li {
      margin-bottom:8px;
    }
    .footer-col ul li a {
      color:var(--muted);
      text-decoration:none;
      font-size:14px;
      transition:color .2s;
    }
    .footer-col ul li a:hover {
      color:var(--accent);
    }
    .footer-bottom {
      max-width:1100px;
      margin:30px auto 0;
      text-align:center;
      font-size:14px;
      color:var(--muted);
    }
    .footer-bottom span { color:var(--accent-dark); font-weight:600; }

    @media (max-width:760px){
      .hero{flex-direction:column; align-items:flex-start}
      .modal{flex-direction:column}
      .modal img{height:260px}
      .cart-side{width:100%}
    }
  </style>
</head>
<body>
<header>
  <div class="brand">Ecommerce</div>
  <div class="search">
    <input id="searchInput" placeholder="Search products, e.g. shoes, jacket..." />
    <div class="filters">
      <select id="categoryFilter">
        <option value="all">All</option>
      </select>
      <button class="btn ghost" id="sortBtn">Sort</button>
    </div>
  </div>
  <div class="icons">
    <button class="btn" id="loginBtn">Login</button>
    <button class="btn cart-btn" id="openCartBtn">Cart <span id="cartCount" class="cart-count">0</span></button>
  </div>
</header>

<main>
  <div class="hero">
    <div>
      <h1>Products</h1>
      <p style="color:var(--muted); margin:6px 0 0">Cart & product details.</p>
    </div>
    <div>
      <button class="btn" id="addSample">All Product Products</button>
    </div>
  </div>

  <section>
    <div id="productsGrid" class="grid"></div>
  </section>
</main>

<!-- Cart sidebar -->
<aside id="cartSide" class="cart-side" aria-hidden="true">
  <h3>Your Cart</h3>
  <div id="cartItems"></div>
  <div style="margin-top:12px">
    <div style="display:flex; justify-content:space-between; color:var(--muted)"><div>Subtotal</div><div id="subtotal">₹0</div></div>
    <button class="btn" id="checkoutBtn" style="width:100%; margin-top:12px">Checkout</button>
    <button class="btn ghost" id="closeCart" style="width:100%; margin-top:8px">Close</button>
  </div>
</aside>

<!-- Product details modal -->
<div id="overlay" class="overlay" role="dialog" aria-hidden="true">
  <div class="modal">
    <div class="left">
      <img id="modalImg" src="" alt="product" />
    </div>
    <div class="right">
      <h2 id="modalTitle">Title</h2>
      <p id="modalDesc" style="color:var(--muted)">Description</p>
      <p style="margin:8px 0" class="price" id="modalPrice">₹0</p>
      <div style="display:flex; gap:8px; margin-top:10px">
        <input id="qty" type="number" min="1" value="1" style="width:80px" />
        <button class="btn" id="addToCartModal">Add to cart</button>
      </div>
      <div style="margin-top:14px; color:var(--muted)">
        <strong>Category:</strong> <span id="modalCategory"></span>
      </div>
      <div style="margin-top:14px;">
        <button id="closeModal" class="btn ghost">Close</button>
      </div>
    </div>
  </div>
</div>

<!-- Login/Register modal -->
<div id="authOverlay" class="overlay" aria-hidden="true">
  <div class="modal" style="max-width:720px; padding:18px">
    <div style="flex:1">
      <h3>Login</h3>
      <div class="form">
        <input id="loginEmail" placeholder="Email" />
        <input id="loginPassword" placeholder="Password" type="password" />
        <button class="btn" id="doLogin">Sign in</button>
      </div>
    </div>
    <div style="width:360px">
      <h3>Register</h3>
      <div class="form">
        <input id="regName" placeholder="Full name" />
        <input id="regEmail" placeholder="Email" />
        <input id="regPassword" placeholder="Password" type="password" />
        <button class="btn" id="doRegister">Create account</button>
      </div>
    </div>
  </div>
</div>

<!-- Footer -->
<footer>
  <div class="footer-grid">
    <div class="footer-col">
      <h4>Shop</h4>
      <ul>
        <li><a href="#">New Arrivals</a></li>
        <li><a href="#">Best Sellers</a></li>
        <li><a href="#">Discounts</a></li>
        <li><a href="#">Gift Cards</a></li>
      </ul>
    </div>
    <div class="footer-col">
      <h4>Support</h4>
      <ul>
        <li><a href="#">Help Center</a></li>
        <li><a href="#">Returns</a></li>
        <li><a href="#">Shipping</a></li>
        <li><a href="#">Track Order</a></li>
      </ul>
    </div>
    <div class="footer-col">
      <h4>Company</h4>
      <ul>
        <li><a href="#">About us</a></li>
        <li><a href="#">Careers</a></li>
        <li><a href="#">Press</a></li>
        <li><a href="#">Blog</a></li>
      </ul>
    </div>
  </div>
  <div class="footer-bottom">
    <small class="text-gray-500 text-sm">
  Made with <span class="text-red-500">❤️</span> by <span class="font-semibold text-gray-800">Deepak Kumar</span> | MERN Stack Developer |
</small>

  </div>
</footer>

<script>
  // ====== Utility & State ======
  const $ = s=>document.querySelector(s);
  const formatRupee = v=>'₹'+Number(v).toLocaleString('en-IN');
  const storage = {get:(k,f)=>{try{return JSON.parse(localStorage.getItem(k))??f}catch(e){return f}},set:(k,v)=>localStorage.setItem(k,JSON.stringify(v))};

  let PRODUCTS=storage.get('products',[]), CART=storage.get('cart',{}), USERS=storage.get('users',[]), ORDERS=storage.get('orders',[]), CURRENT_USER=storage.get('currentUser',null);
  let currentModalProduct=null;

  const sampleProducts=[
    {id:'p1',title:'Noise-Cancelling Headphones',price:6999,img:'https://picsum.photos/600/400?random=1',category:'Electronics',desc:'Over-ear headphones with long battery life.'},
    {id:'p2',title:'Slim Fit Jeans',price:1799,img:'https://picsum.photos/600/400?random=2',category:'Clothing',desc:'Dark blue denim with slim fit.'},
    {id:'p3',title:'Leather Wallet',price:1299,img:'https://picsum.photos/600/400?random=3',category:'Accessories',desc:'Compact bi-fold wallet.'}
  ];

  function renderProducts(list=PRODUCTS){
    const grid=$('#productsGrid'); grid.innerHTML='';
    if(list.length===0){ grid.innerHTML='<div style="grid-column:1/-1;text-align:center;color:var(--muted)">No products. Click "Load Sample Products".</div>'; return;}
    list.forEach(p=>{
      const div=document.createElement('div'); div.className='card';
      div.innerHTML=`
        <img src="${p.img}" alt="${p.title}"/>
        <div style="margin-top:8px">
          <div class="meta">
            <div class="title">${p.title}</div>
            <div class="price">${formatRupee(p.price)}</div>
          </div>
          <button class="btn" onclick="openModal('${p.id}')">View</button>
        </div>`;
      grid.appendChild(div);
    });
  }

  function renderCart(){
    const cartDiv=$('#cartItems'); cartDiv.innerHTML=''; let subtotal=0;
    Object.values(CART).forEach(item=>{
      subtotal+=item.qty*item.price;
      const div=document.createElement('div'); div.className='cart-item';
      div.innerHTML=`<img src="${item.img}"/><div style="flex:1"><strong>${item.title}</strong><br/>Qty: ${item.qty}<br/>${formatRupee(item.price*item.qty)}</div>
      <button class="btn ghost" onclick="removeFromCart('${item.id}')">Remove</button>`;
      cartDiv.appendChild(div);
    });
    $('#cartCount').innerText=Object.keys(CART).length;
    $('#subtotal').innerText=formatRupee(subtotal);
    storage.set('cart',CART);
  }

  function openModal(id){
    const p=PRODUCTS.find(x=>x.id===id); if(!p) return;
    currentModalProduct=p;
    $('#modalImg').src=p.img;
    $('#modalTitle').innerText=p.title;
    $('#modalDesc').innerText=p.desc;
    $('#modalPrice').innerText=formatRupee(p.price);
    $('#modalCategory').innerText=p.category;
    $('#qty').value=1;
    $('#overlay').classList.add('open');
  }

  function addToCart(id,qty){
    const p=PRODUCTS.find(x=>x.id===id); if(!p) return;
    if(CART[id]) CART[id].qty+=qty; else CART[id]={...p,qty};
    renderCart();
    $('#overlay').classList.remove('open');
    alert('Added to cart!');
  }

  function removeFromCart(id){ delete CART[id]; renderCart(); }

  function login(email,password){
    const user=USERS.find(u=>u.email===email && u.password===password);
    if(user){ CURRENT_USER=user; storage.set('currentUser',CURRENT_USER); alert('Logged in!'); $('#authOverlay').classList.remove('open'); } else alert('Invalid credentials'); 
  }
  function register(name,email,password){
    if(USERS.find(u=>u.email===email)){ alert('Email exists!'); return; }
    const user={name,email,password}; USERS.push(user); storage.set('users',USERS); alert('Registered!'); $('#authOverlay').classList.remove('open'); 
  }

  function checkout(){
    if(!CURRENT_USER){ alert('Please login!'); $('#authOverlay').classList.add('open'); return; }
    if(Object.keys(CART).length===0){ alert('Cart is empty!'); return; }
    ORDERS.push({user:CURRENT_USER,items:CART,date:new Date()}); CART={}; renderCart(); alert('Order placed!'); storage.set('orders',ORDERS); 
  }

  function filterProducts(){
    const cat=$('#categoryFilter').value; const search=$('#searchInput').value.toLowerCase();
    renderProducts(PRODUCTS.filter(p=>(cat==='all'||p.category===cat)&&p.title.toLowerCase().includes(search)));
  }

  // ====== Events ======
  $('#addSample').onclick=()=>{
    PRODUCTS=sampleProducts; storage.set('products',PRODUCTS); 
    const cats=[...new Set(PRODUCTS.map(p=>p.category))];
    const sel=$('#categoryFilter'); sel.innerHTML='<option value="all">All</option>'; cats.forEach(c=>sel.innerHTML+=`<option value="${c}">${c}</option>`);
    renderProducts();
  };
  $('#openCartBtn').onclick=()=>$('#cartSide').classList.add('open');
  $('#closeCart').onclick=()=>$('#cartSide').classList.remove('open');
  $('#overlay').onclick=e=>{if(e.target==$('#overlay'))$('#overlay').classList.remove('open')};
  $('#closeModal').onclick=()=>$('#overlay').classList.remove('open');
  $('#addToCartModal').onclick=()=>addToCart(currentModalProduct.id,Number($('#qty').value));
  $('#loginBtn').onclick=()=>$('#authOverlay').classList.add('open');
  $('#doLogin').onclick=()=>login($('#loginEmail').value,$('#loginPassword').value);
  $('#doRegister').onclick=()=>register($('#regName').value,$('#regEmail').value,$('#regPassword').value);
  $('#checkoutBtn').onclick=checkout;
  $('#searchInput').oninput=filterProducts;
  $('#categoryFilter').onchange=filterProducts;

  // ====== Initial render ======
  renderProducts(); renderCart();






  // ==== Register ====
async function register(name,email,password){
  try {
    const res = await fetch("http://localhost:5000/api/register", {
      method: "POST",
      headers: {"Content-Type":"application/json"},
      body: JSON.stringify({ name,email,password })
    });
    const data = await res.json();
    if(res.ok){
      alert("Registered successfully!");
      $('#authOverlay').classList.remove('open');
    } else {
      alert(data.msg || "Registration failed");
    }
  } catch (err) {
    alert("Server error");
  }
}

// ==== Login ====
async function login(email,password){
  try {
    const res = await fetch("http://localhost:5000/api/login", {
      method: "POST",
      headers: {"Content-Type":"application/json"},
      body: JSON.stringify({ email,password })
    });
    const data = await res.json();
    if(res.ok){
      CURRENT_USER = data.user;
      localStorage.setItem("token", data.token);  // save JWT token
      storage.set("currentUser", CURRENT_USER);
      alert("Login successful!");
      $('#authOverlay').classList.remove('open');
    } else {
      alert(data.msg || "Login failed");
    }
  } catch (err) {
    alert("Server error");
  }
}






  
</script>

</body>
</html>
